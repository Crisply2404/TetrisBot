# 变更提案: 对战“更像最优解” + 采样点管理与校准预览

## 需求背景
现在扩展在对战（vs）里有两个让人很不爽的点：
1) 你会感觉它“不像最优解”：看起来更像在“随便消行”，不怎么打 T-Spin Triple，而且我们还会在候选里做二次选择，看起来不像严格最优。
2) 棋盘对齐靠校准 + 采样，但采样点一旦记录错了就很难“反悔”，而且校准时不方便预览（拖动框的时候看不到提示如何跟着变）。

你希望：
- **最优解**要有一个更明确的定义（尤其对战模式），并且能解释“为什么我们现在不是最优”。
- 能找到 **tetr.io 伤害规则**的“完整来源”，并把它作为后续“对战目标”的依据。
- **采样点（scaleSamples）**能图形化管理：能删/改/禁用，避免误操作后没法回滚。
- **校准模式**拖动框时，叠加提示也能实时跟着变，方便预览。
- **保存校准**不应该默认保存为样本；需要一个单独的“保存为样本”入口。
- tetr.io 其实允许方块在**棋盘上边界之外**（上方缓冲区）存在/移动：我们的叠加提示也要能显示出来，别把上面那一截“裁掉”。
- 需要一个**快捷键**（默认 `E`）一键开/关提示，方便自己思考完再开提示“对答案”。
- `读取更长块序（更强但更像作弊）` 这个开关，开启/关闭时要用**两套互不影响的记忆系统**（避免 undo/hold 时建议互相污染）。

> 说明：你说不会拿去作弊。这里的设计会尽量偏“训练/分析/自用”，并把“对战目标/伤害估算”作为可选实验功能，不强行默认启用。

## 产品分析

### 目标用户与场景
- **用户群体:** 自己练习 40L / 对战思路的人（需要“看得懂”的提示，而不是自动操作）
- **使用场景:** 进入一局后实时给落点提示；遇到对不齐时能快速校准；窗口缩放时也能尽量保持对齐
- **核心痛点:** “看起来不够聪明”和“对齐总要折腾”

### 价值主张与成功指标
- **价值主张:** 提示更可信（更接近你理解的“对战收益最大”），对齐更省心（采样点可控、可回滚）
- **成功指标:**
  - 对战预设下，能明显更容易出现合理的 T-Spin（包括 Triple 的机会），并能解释/展示依据（候选、排行、估算信息）
  - 校准时拖动框能实时预览叠加效果；采样点可视化管理（至少支持删除/禁用/导入导出）

### 人文关怀
- 不做自动按键，避免把人“变成观看者”
- 明确提示“这是建议不是答案”，减少挫败感

## 变更内容
1. 引擎“挑选策略”明确化：提供“严格跟随引擎第一名/偏好旋转/（可选）按 tetr.io 伤害估算重排”等策略，并在详情页显示原因。
2. 对战上下文补齐：尽量从 tetr.io 状态里提取 combo / B2B（如果能读到），喂给 cold-clear 的 start，让它更像对战。
3. 采样点管理：新增“采样点管理页”，可视化编辑 `scaleSamples`（删/禁用/导入导出）。
4. 校准体验改进：校准模式拖动框实时预览；“保存校准”和“保存为样本”拆开。
5. 叠加提示支持显示“上边界之外”的方块格子（上方缓冲区）。
6. 增加快捷键一键开关提示（默认 `E`，避免在输入框打字时误触发）。
7. 记忆系统按 `读取更长块序` 开关分离成两套，互不影响（避免 undo/hold 后出现“同局面不同建议”的错觉）。

## 影响范围
- **模块:**
  - `engine`（对战目标、候选选择、对战上下文）
  - `state`（尝试提取 combo/B2B 等）
  - `ui`（采样点编辑器、校准预览、按钮调整）
- **文件:**
  - `extension/engine/coldClearTbpClient.js`
  - `extension/page/pageHook.js`
  - `extension/content/content.js`
  - `extension/content/overlay.js`
  - `extension/ui/*`
  - `extension/shared/settings.js`

## 核心场景

### 需求: 对战“最优解”更可控
**模块:** engine
当我在对战模式时：
- 我能选择“严格跟随引擎最优（第一名）”或“偏好旋转”等策略
- 详情页能告诉我：当前选择用了哪种策略、候选排行是多少、（可选）估算伤害是多少

### 需求: 采样点可回滚
**模块:** ui
当我不小心记录了一个不准的样本：
- 我能在一个页面里看到所有样本
- 我能一键删除/禁用它
- 我能导入/导出 JSON（方便备份/发给你）

### 需求: 校准实时预览
**模块:** ui
当我在校准模式拖动绿色框：
- 叠加提示会跟着实时更新（不用保存再看）
- 我可以“只保存校准”，也可以“保存为样本”

## 风险评估
- **风险:** tetr.io 规则可能更新，伤害估算可能过时或与实际略有差异
- **缓解:** 把“按伤害估算重排”做成可选实验；并在详情页显示“规则来源/版本说明”与可关闭开关
- **风险:** 快捷键可能和玩家自己按键习惯冲突
- **缓解:** 默认只监听在“非输入框/非聊天输入”场景；并提供可改键/可关闭
