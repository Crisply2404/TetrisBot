# 变更提案: CC1 仿 CC2 策略 + 一键重置 + 不同步兜底

## 需求背景
目前扩展在某些场景下会出现“建议块不对/地形不对/像是停留在上一局”的问题，尤其是：
- 退出对局后再进一局
- 切换到别的模式（例如双人练习）

另外，CC2（本地服务）效果更像对战，但需要你额外开着服务。你希望在只用 CC1（插件离线引擎）时，也能更像 CC2 一点，从而减少对 CC2 的依赖。

## 变更内容
1. **CC1 新增一种候选挑选策略：仿 CC2 默认权重重排**（只影响 CC1；CC2 仍按它自己内部策略算）。
2. **更严格的不同步检测：如果“这个落点还能往下掉”，直接当成不同步**，立刻 reset 再重算。
3. **提供一个“手动重置”按钮**：一键清掉异常缓存 + 重置引擎 + 让页面重新抓当前局面，避免“卡在旧局面”。
4. **补充 Windows 上 Cargo/Rust 环境变量说明**，降低你编译/运行 CC2 的门槛。

## 影响范围
- **模块:**
  - 引擎对接（CC1 候选重排、不同步检测、reset）
  - UI（弹窗/详情页增加 reset 按钮与提示）
  - 页面 Hook（需要支持“强制重新捕获游戏 API”）
- **文件:**
  - `extension/engine/coldClearTbpClient.js`
  - `extension/content/content.js`
  - `extension/page/pageHook.js`
  - `extension/ui/popup.*`（以及可能的 `extension/ui/details.*`）
  - `cc2-server/README.md`

## 核心场景

### 需求: CC1 更像 CC2（减少依赖本地服务）
**模块:** engine
当引擎走 CC1 时，除了“严格选第 1 名”，还可以选择“仿 CC2 权重”来挑更像对战/更合理的落点。

#### 场景: 只用 CC1 也能更聪明
条件描述：设置里选择“只用插件 CC1”，并把“候选挑选策略”切到“仿 CC2 默认权重（仅 CC1）”
- 预期结果：相同局面下，建议更稳定、旋转/连击/保持 B2B 的倾向更合理（不追求完全等同 CC2，但要明显好于纯“第 1 名”）

### 需求: 发现“悬空落点”立即自救
**模块:** engine/content
如果建议落点还能继续往下掉，说明很可能发生了不同步（或坐标解释异常）。

#### 场景: 悬空提示要立刻消失并自恢复
条件描述：冷清时刻、切模式、撤回等导致偶发“悬空落点”
- 预期结果：不画这个错误落点；立刻 reset 引擎；下一次重算恢复正常

### 需求: 一键重置异常缓存/旧局面
**模块:** ui/content/pagehook
你需要一个明确的“重置”入口，手动把扩展拉回正常状态。

#### 场景: 退出对局再进/切模式后卡旧局面
条件描述：扩展提示的当前块/地形与游戏实际不一致
- 预期结果：点一下“重置”，扩展立刻清空旧画面并重新抓当前局面；不再显示上一局的状态

## 风险评估
- **风险:** CC1 仿 CC2 权重属于“二次重排”，可能会让部分局面看起来更像对战，但也可能在 40L 里变慢/变怪。
  - **缓解:** 作为可选策略，默认仍保持“严格选第 1 名”；并限制只在 CC1 生效。
- **风险:** reset 过于频繁可能导致短时间“没建议”。
  - **缓解:** reset 只在检测到明显错误（悬空/不同步）时触发；手动 reset 由用户主动点击。
